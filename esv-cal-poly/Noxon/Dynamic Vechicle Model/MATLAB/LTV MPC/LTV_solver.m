% Author: Nikola Noxon
% California Polytehnic State University
% email: nikolanoxon@gmail.com
% Oct 2011; Last revision: 2-20-16

%------------- BEGIN CODE --------------

%--------------------------------
% SETUP
%--------------------------------

% Set Constants
tau = 1; % sec
g   = 9.81; % m/s^2

% Set Independent Variables and Input Variable
v_x = 11.11;
v_y = 0;
phi = 0;
psi = 0;
psi_d = 0; 
phi_d = 0;

d_steer = 0

% %--------------------------------
% % TRAXAS SLASH PAREMETERS
% %--------------------------------
% % Longitudinal distance between the center of tire and vehicle center of mass
% l_fs =0.212; % m			 
% l_rs =0.126; % m		
% 
% % Front and rear track width
% t_f =0.307; % m
% t_r =0.307; % m
% 
% % Distance between ground and static roll center
% h_f =0.021; % m				
% h_r = 0.045; % m
% 
% % Height of sprung mass CG above ground
% h_cgs = 0.107; % m
% 
% % Height of front/rear unsprung mass CG above ground
% h_cguf = 0.051; % m
% h_cgur =0.051; % m
% 
% % Total vehicle mass
% M =3.116; % kg;
% 
% % Front/Rear unsprung mass
% M_uf =0.342; % kg
% M_ur =0.329; % kg
% 
% % Moments of inertia of sprung mass about its CG
% I_xxs = 0.005; % g-mm2
% I_yys = 0.043; % g-mm2
% I_zzs = 0.045; % g-mm2
% 
% % Products of inertia of sprung mass about its CG
% I_xys = 0.0006; % g-mm2
% I_xzs = 0.0009; % g-mm2
% I_yzs = 0.00006; % g-mm2
% 
% % Moment of inertia of wheel about its spin axis
% I_trf =  0.0002; % kg-m^2
% I_tlf =  0.0002; % kg-m^2
% I_trr =  0.0002; % kg-m^2
% I_tlr =  0.0002; % kg-m^2
% 
% % Front/rear spring stiffness
% % to be calculated
% K_spf = 0; % N/m
% K_spr = 0; % N/m
% 
% % Front/rear spring damping 
% % to be calculated
% B_f = 0; % N-s/m
% B_r = 0; % N-s/m
%  
% % Front/Rear anti-roll bar stiffness
% K_rf = 0; % N-m/rad
% K_rr = 0; % N-m/rad
%  
% % Steering-to-wheel angle ratio
% % to be calculated
% K_sr = 1;
% 
% % Tire Width
% t_wid =0.044; % m
% 
% % Tire Radius
% t_rad =0.054; % m

%---------------------------------------%
%VEHICLE PAREMETERS
%---------------------------------------%
%lengths
l_fs = 1.01476;             %length from sprung mass CG to front suspension
l_rs = 1.67524;             %length from sprung mass CG to rear suspension
t_f = 1.540;                %front vehicle width
t_r = 1.530;                %rear vehicle width
h_f = 0.130;                %height from ground to front suspension
h_r = 0.110;                %height from ground to rear suspension
h_cgs = 0.567851;           %height from ground to sprung CG
h_cguf = 0.320;             %height from ground to front unsprung CG
h_cgur = 0.320;             %height from ground to rear unsprung CG

%mass/inertia
M = 1704.7;                 %total vehicle mass
M_uf = 98.1;                %unsprung front mass
M_ur = 79.7;                %unsprung rear mass
I_xxs = 440.911;            %sprung XX inertia
I_xys = 0;                  %sprung XY inertia
I_xzs = 7.54097;            %sprung XZ inertia
I_yys = 2498.900;           %sprung YY inertia
I_yzs = 0;                  %sprung yz inertia
I_zzs = 2619.28;            %sprung ZZ inertia
I_zzuf = M_uf*(t_f/2)^2;    %front unsprung ZZ inertia
I_zzur = M_ur*(t_r/2)^2;    %rear unsprung ZZ inertia
I_tlf = 0.99;               %front left tire inertia
I_trf = 0.99;               %front right tire inertia
I_tlr = 0.99;               %rear left tire inertia
I_trr = 0.99;               %rear right tire inertia

%tire slip curve coordinates (slip-%, mu)
Vary =  [0.0 0.0
        0.08 0.4
        0.15 0.6
         0.3 0.8
         1.0 0.4];

%spring/dampers
K_spf = 27850; %N/m
K_spr = 18160; %N/m
 
B_f = 2991.5; %N-s/m
B_r = 2991.5; %N-s/m
 
%anti_roll bars
K_rf = 384.0*180/pi; %Nm/rad
K_rr = 344.4*180/pi;

%steering-to-wheel angle ratio
K_sr = 15.97;

%----------------------
% CONSTANT CALCULATED PARAMETERS
%----------------------
% Roll stiffness
K_phif = 0.766*K_spf*t_f^2/2 + K_rf;
K_phir = 0.827*K_spr*t_r^2/2 + K_rr;
K_phi = (K_phif + K_phir); 

% Roll damping
B_phif = 0.766*B_f*t_f^2/2; % Nm-s/rad
B_phir = 0.827*B_r*t_r^2/2; % Nm-s/rad
B_phi = (B_phif + B_phir); % Nm-s/rad
 
% Moment of inertia of unsprung front/rear mass about their CoG
I_zzuf = M_uf*(t_f/2)^2;
I_zzur = M_ur*(t_r/2)^2;

% Wheelbase
L = l_fs + l_rs;

% Sprung Mass
M_s = M - M_uf - M_ur;

% Longitudinal distance from sprung CG to total mass CG
l_cgs = (M_ur*l_rs - M_uf*l_fs)/M;

% Longitudinal distance from total CG to front axle
l_f = l_fs + l_cgs;
% Longitudinal distance from total CG to rear axle
l_r = l_rs - l_cgs;

% Front/rear vehicle static axle mass
M_f = M*l_r/L;
M_r = M*l_f/L;

% Height of sprung mass CG above roll center (height of roll center origin)
h_o = h_f + l_f*(h_r - h_f)/L;

% Height of sprung mass CG above the origin
h_s = h_cgs - h_o;

% Height of front/rear unsprung mass above the origin
h_uf = h_cguf - h_o;
h_ur = h_cgur - h_o;

% Height of total vehicle CG
h_cg = (M_s*h_cgs + M_uf*h_cguf + M_ur*h_cgur)/M;

% Chassis Inertial Tensor
I_body = [I_xxs+M_s*h_s^2,I_xys,I_xzs+M_s*h_s*l_cgs;...
       I_xys,I_yys+M_s*(h_s^2+l_cgs^2),I_yzs;...
       I_xzs+M_s*h_s*l_cgs,I_yzs,I_zzs+M_s*l_cgs^2];
   
I_zzus = M_uf*l_f^2 + ...
         M_ur*l_r^2 + ...
         I_zzuf + I_zzur;
 

I_xxo = I_body(1,1);
I_zzo = I_body(3,3) + I_zzus;

%Tire Normal Forces
Fzlf = M*g*l_r/(2*L);               
Fzrf = M*g*l_r/(2*L);
Fzlr = M*g*l_f/(2*L);
Fzrr = M*g*l_f/(2*L);

% Linearized cornering coefficients
vary = Vary(2,2)/Vary(2,1);

C_alf = vary*Fzlf;
C_arf = vary*Fzrf;
C_alr = vary*Fzlr;
C_arr = vary*Fzrr;

%tire steer angle
delta = d_steer/(180*K_sr)*pi; %radians

%-------------------
%EQUATIONS OF MOTION
%-------------------
% mass matrix for coupled equations of motion
M11 = M;
M14  = 0;
M22 = M;
M23 = -M_s*h_s;
M32 = M_s*h_s;
M33 = I_xxs+2*M_s*h_s^2;
M34 = (I_xzs+2*M_s*h_s*l_cgs);
M41 = 0;
M43 = (I_xzs+M_s*h_s*l_cgs);
M44 = I_zzo;

% coupled equations of motion
A1 = -2*M_s*h_s;
B1 = 0;
C1 = 0;
C2 = 0;
C3 = 0;
C4 = -M_s*h_s;
D1 = 0;
D2 = 0;

A_kt = ...
[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           -((Fzlf*vary*sin(delta)*(sin(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*sin(delta)*(sin(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1))/M11,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ((Fzlf*vary*sin(delta)*(cos(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*sin(delta)*(cos(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1))/M11,                                                                                                                                                                                        (A1*psi_d)/M11,                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (A1*phi_d + (Fzlf*vary*sin(delta)*((l_f*cos(delta) - (t_f*sin(delta))/2)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (((t_f*cos(delta))/2 + l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*sin(delta)*((l_f*cos(delta) + (t_f*sin(delta))/2)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (((t_f*cos(delta))/2 - l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1))/M11, 0
 (M11*M23*M34*(l_r*((Fzlr*vary*(v_y - l_r*psi_d))/((v_x + (psi_d*t_r)/2)^2*((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1)) + (Fzrr*vary*(v_y - l_r*psi_d))/((v_x - (psi_d*t_r)/2)^2*((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1))) - l_f*((Fzlf*vary*cos(delta)*(sin(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*(sin(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)) + (t_f*((Fzlf*vary*sin(delta)*(sin(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) - (Fzrf*vary*sin(delta)*(sin(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/2))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) + ((M11*M23*(M11*M32*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22*M32*M34*M43) + M11*(M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44))*((Fzlr*vary*(v_y - l_r*psi_d))/((v_x + (psi_d*t_r)/2)^2*((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1)) + (Fzrr*vary*(v_y - l_r*psi_d))/((v_x - (psi_d*t_r)/2)^2*((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1)) + (Fzlf*vary*cos(delta)*(sin(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*(sin(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/(M11*M22*(M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)) - (C4*M23*psi_d*(M11*M22*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22^2*M34*M43))/(M22*(M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)), - (M11*M23*M34*(l_r*((Fzlr*vary)/((v_x + (psi_d*t_r)/2)*((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1)) + (Fzrr*vary)/((v_x - (psi_d*t_r)/2)*((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1))) - l_f*((Fzlf*vary*cos(delta)*(cos(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*(cos(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)) + (t_f*((Fzlf*vary*sin(delta)*(cos(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) - (Fzrf*vary*sin(delta)*(cos(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/2))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - ((M11*M23*(M11*M32*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22*M32*M34*M43) + M11*(M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44))*((Fzlr*vary)/((v_x + (psi_d*t_r)/2)*((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1)) + (Fzrr*vary)/((v_x - (psi_d*t_r)/2)*((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1)) + (Fzlf*vary*cos(delta)*(cos(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*(cos(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/(M11*M22*(M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)), (M23*(M11*M22*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22^2*M34*M43)*(B_phif + B_phir))/(M22*(M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)), (M23*(M11*M22*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22^2*M34*M43)*(K_phif + K_phir))/(M22*(M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)), (M11*M23*M34*(l_f*((Fzlf*vary*cos(delta)*((l_f*cos(delta) - (t_f*sin(delta))/2)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (((t_f*cos(delta))/2 + l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*((l_f*cos(delta) + (t_f*sin(delta))/2)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (((t_f*cos(delta))/2 - l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)) - (t_f*((Fzlf*vary*sin(delta)*((l_f*cos(delta) - (t_f*sin(delta))/2)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (((t_f*cos(delta))/2 + l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) - (Fzrf*vary*sin(delta)*((l_f*cos(delta) + (t_f*sin(delta))/2)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (((t_f*cos(delta))/2 - l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/2 + l_r*((Fzlr*vary*(l_r/(v_x + (psi_d*t_r)/2) + (t_r*(v_y - l_r*psi_d))/(2*(v_x + (psi_d*t_r)/2)^2)))/((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1) + (Fzrr*vary*(l_r/(v_x - (psi_d*t_r)/2) - (t_r*(v_y - l_r*psi_d))/(2*(v_x - (psi_d*t_r)/2)^2)))/((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1))))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) + ((M11*M23*(M11*M32*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22*M32*M34*M43) + M11*(M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44))*((Fzlr*vary*(l_r/(v_x + (psi_d*t_r)/2) + (t_r*(v_y - l_r*psi_d))/(2*(v_x + (psi_d*t_r)/2)^2)))/((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1) + (Fzrr*vary*(l_r/(v_x - (psi_d*t_r)/2) - (t_r*(v_y - l_r*psi_d))/(2*(v_x - (psi_d*t_r)/2)^2)))/((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1) - (Fzlf*vary*cos(delta)*((l_f*cos(delta) - (t_f*sin(delta))/2)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (((t_f*cos(delta))/2 + l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) - (Fzrf*vary*cos(delta)*((l_f*cos(delta) + (t_f*sin(delta))/2)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (((t_f*cos(delta))/2 - l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/(M11*M22*(M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)) - (C4*M23*v_x*(M11*M22*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22^2*M34*M43))/(M22*(M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)), 0
                                                                                                                   (C4*psi_d*(M11*M22*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22^2*M34*M43))/((M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)) - (M11*M22*M34*(l_r*((Fzlr*vary*(v_y - l_r*psi_d))/((v_x + (psi_d*t_r)/2)^2*((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1)) + (Fzrr*vary*(v_y - l_r*psi_d))/((v_x - (psi_d*t_r)/2)^2*((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1))) - l_f*((Fzlf*vary*cos(delta)*(sin(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*(sin(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)) + (t_f*((Fzlf*vary*sin(delta)*(sin(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) - (Fzrf*vary*sin(delta)*(sin(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/2))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - ((M11*M32*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22*M32*M34*M43)*((Fzlr*vary*(v_y - l_r*psi_d))/((v_x + (psi_d*t_r)/2)^2*((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1)) + (Fzrr*vary*(v_y - l_r*psi_d))/((v_x - (psi_d*t_r)/2)^2*((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1)) + (Fzlf*vary*cos(delta)*(sin(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*(sin(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/((M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)),                                                                                                             ((M11*M32*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22*M32*M34*M43)*((Fzlr*vary)/((v_x + (psi_d*t_r)/2)*((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1)) + (Fzrr*vary)/((v_x - (psi_d*t_r)/2)*((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1)) + (Fzlf*vary*cos(delta)*(cos(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*(cos(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/((M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)) + (M11*M22*M34*(l_r*((Fzlr*vary)/((v_x + (psi_d*t_r)/2)*((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1)) + (Fzrr*vary)/((v_x - (psi_d*t_r)/2)*((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1))) - l_f*((Fzlf*vary*cos(delta)*(cos(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*(cos(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)) + (t_f*((Fzlf*vary*sin(delta)*(cos(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) - (Fzrf*vary*sin(delta)*(cos(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/2))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44),        -((M11*M22*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22^2*M34*M43)*(B_phif + B_phir))/((M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)),        -((M11*M22*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22^2*M34*M43)*(K_phif + K_phir))/((M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)),                                                                                                                   (C4*v_x*(M11*M22*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22^2*M34*M43))/((M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)) - ((M11*M32*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22*M32*M34*M43)*((Fzlr*vary*(l_r/(v_x + (psi_d*t_r)/2) + (t_r*(v_y - l_r*psi_d))/(2*(v_x + (psi_d*t_r)/2)^2)))/((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1) + (Fzrr*vary*(l_r/(v_x - (psi_d*t_r)/2) - (t_r*(v_y - l_r*psi_d))/(2*(v_x - (psi_d*t_r)/2)^2)))/((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1) - (Fzlf*vary*cos(delta)*((l_f*cos(delta) - (t_f*sin(delta))/2)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (((t_f*cos(delta))/2 + l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) - (Fzrf*vary*cos(delta)*((l_f*cos(delta) + (t_f*sin(delta))/2)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (((t_f*cos(delta))/2 - l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/((M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)) - (M11*M22*M34*(l_f*((Fzlf*vary*cos(delta)*((l_f*cos(delta) - (t_f*sin(delta))/2)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (((t_f*cos(delta))/2 + l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*((l_f*cos(delta) + (t_f*sin(delta))/2)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (((t_f*cos(delta))/2 - l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)) - (t_f*((Fzlf*vary*sin(delta)*((l_f*cos(delta) - (t_f*sin(delta))/2)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (((t_f*cos(delta))/2 + l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) - (Fzrf*vary*sin(delta)*((l_f*cos(delta) + (t_f*sin(delta))/2)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (((t_f*cos(delta))/2 - l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/2 + l_r*((Fzlr*vary*(l_r/(v_x + (psi_d*t_r)/2) + (t_r*(v_y - l_r*psi_d))/(2*(v_x + (psi_d*t_r)/2)^2)))/((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1) + (Fzrr*vary*(l_r/(v_x - (psi_d*t_r)/2) - (t_r*(v_y - l_r*psi_d))/(2*(v_x - (psi_d*t_r)/2)^2)))/((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1))))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44), 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       0,                                                                                                                                                                                                     1,                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0, 0
                                                                                                                                                                                                                                                                                                                     ((M11*M22*M33 - M11*M23*M32)*(l_r*((Fzlr*vary*(v_y - l_r*psi_d))/((v_x + (psi_d*t_r)/2)^2*((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1)) + (Fzrr*vary*(v_y - l_r*psi_d))/((v_x - (psi_d*t_r)/2)^2*((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1))) - l_f*((Fzlf*vary*cos(delta)*(sin(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*(sin(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)) + (t_f*((Fzlf*vary*sin(delta)*(sin(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) - (Fzrf*vary*sin(delta)*(sin(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/2))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - (M11*M32*M43*((Fzlr*vary*(v_y - l_r*psi_d))/((v_x + (psi_d*t_r)/2)^2*((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1)) + (Fzrr*vary*(v_y - l_r*psi_d))/((v_x - (psi_d*t_r)/2)^2*((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1)) + (Fzlf*vary*cos(delta)*(sin(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*(sin(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (cos(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) + (C4*M11*M22*M43*psi_d)/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44),                                                                                                                                                                                                       (M11*M32*M43*((Fzlr*vary)/((v_x + (psi_d*t_r)/2)*((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1)) + (Fzrr*vary)/((v_x - (psi_d*t_r)/2)*((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1)) + (Fzlf*vary*cos(delta)*(cos(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*(cos(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - ((M11*M22*M33 - M11*M23*M32)*(l_r*((Fzlr*vary)/((v_x + (psi_d*t_r)/2)*((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1)) + (Fzrr*vary)/((v_x - (psi_d*t_r)/2)*((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1))) - l_f*((Fzlf*vary*cos(delta)*(cos(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*(cos(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)) + (t_f*((Fzlf*vary*sin(delta)*(cos(delta)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) - (Fzrf*vary*sin(delta)*(cos(delta)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (sin(delta)*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/2))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44),                                                                                                                -(M11*M22*M43*(B_phif + B_phir))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44),                                                                                                                -(M11*M22*M43*(K_phif + K_phir))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44),                                                                                                                                                                                                                                                                                                                     ((M11*M22*M33 - M11*M23*M32)*(l_f*((Fzlf*vary*cos(delta)*((l_f*cos(delta) - (t_f*sin(delta))/2)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (((t_f*cos(delta))/2 + l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) + (Fzrf*vary*cos(delta)*((l_f*cos(delta) + (t_f*sin(delta))/2)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (((t_f*cos(delta))/2 - l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)) - (t_f*((Fzlf*vary*sin(delta)*((l_f*cos(delta) - (t_f*sin(delta))/2)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (((t_f*cos(delta))/2 + l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) - (Fzrf*vary*sin(delta)*((l_f*cos(delta) + (t_f*sin(delta))/2)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (((t_f*cos(delta))/2 - l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/2 + l_r*((Fzlr*vary*(l_r/(v_x + (psi_d*t_r)/2) + (t_r*(v_y - l_r*psi_d))/(2*(v_x + (psi_d*t_r)/2)^2)))/((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1) + (Fzrr*vary*(l_r/(v_x - (psi_d*t_r)/2) - (t_r*(v_y - l_r*psi_d))/(2*(v_x - (psi_d*t_r)/2)^2)))/((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1))))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - (M11*M32*M43*((Fzlr*vary*(l_r/(v_x + (psi_d*t_r)/2) + (t_r*(v_y - l_r*psi_d))/(2*(v_x + (psi_d*t_r)/2)^2)))/((v_y - l_r*psi_d)^2/(v_x + (psi_d*t_r)/2)^2 + 1) + (Fzrr*vary*(l_r/(v_x - (psi_d*t_r)/2) - (t_r*(v_y - l_r*psi_d))/(2*(v_x - (psi_d*t_r)/2)^2)))/((v_y - l_r*psi_d)^2/(v_x - (psi_d*t_r)/2)^2 + 1) - (Fzlf*vary*cos(delta)*((l_f*cos(delta) - (t_f*sin(delta))/2)/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) - (((t_f*cos(delta))/2 + l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2)))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))^2/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1) - (Fzrf*vary*cos(delta)*((l_f*cos(delta) + (t_f*sin(delta))/2)/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)) + (((t_f*cos(delta))/2 - l_f*sin(delta))*(cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2)))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2))/((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))^2/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))^2 + 1)))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) + (C4*M11*M22*M43*v_x)/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44), 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       0,                                                                                                                                                                                                     0,                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              1, 0]
 
 
B_kt =...
[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          -(Fzlf*vary*sin(delta) + Fzrf*vary*sin(delta) - Fzlf*vary*cos(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))) - Fzrf*vary*cos(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))))/M11
 ((M11*M23*(M11*M32*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22*M32*M34*M43) + M11*(M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44))*(Fzlf*vary*cos(delta) + Fzrf*vary*cos(delta) + Fzlf*vary*sin(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))) + Fzrf*vary*sin(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)))))/(M11*M22*(M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)) - (M11*M23*M34*(l_f*(Fzlf*vary*cos(delta) + Fzrf*vary*cos(delta) + Fzlf*vary*sin(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))) + Fzrf*vary*sin(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)))) - (t_f*(Fzlf*vary*sin(delta) - Fzrf*vary*sin(delta) - Fzlf*vary*cos(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))) + Fzrf*vary*cos(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)))))/2))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)
                                                                                                           (M11*M22*M34*(l_f*(Fzlf*vary*cos(delta) + Fzrf*vary*cos(delta) + Fzlf*vary*sin(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))) + Fzrf*vary*sin(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)))) - (t_f*(Fzlf*vary*sin(delta) - Fzrf*vary*sin(delta) - Fzlf*vary*cos(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))) + Fzrf*vary*cos(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)))))/2))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - ((M11*M32*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - M11^2*M22*M32*M34*M43)*(Fzlf*vary*cos(delta) + Fzrf*vary*cos(delta) + Fzlf*vary*sin(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))) + Fzrf*vary*sin(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)))))/((M11*M22*M33 - M11*M23*M32)*(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0
                                                                                                                                                                                                   - ((M11*M22*M33 - M11*M23*M32)*(l_f*(Fzlf*vary*cos(delta) + Fzrf*vary*cos(delta) + Fzlf*vary*sin(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))) + Fzrf*vary*sin(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)))) - (t_f*(Fzlf*vary*sin(delta) - Fzrf*vary*sin(delta) - Fzlf*vary*cos(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))) + Fzrf*vary*cos(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)))))/2))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44) - (M11*M32*M43*(Fzlf*vary*cos(delta) + Fzrf*vary*cos(delta) + Fzlf*vary*sin(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x + (psi_d*t_f)/2))/(cos(delta)*(v_x + (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d))) + Fzrf*vary*sin(delta)*atan((cos(delta)*(v_y + l_f*psi_d) - sin(delta)*(v_x - (psi_d*t_f)/2))/(cos(delta)*(v_x - (psi_d*t_f)/2) + sin(delta)*(v_y + l_f*psi_d)))))/(M11*M22*M34*M43 - M11*M22*M33*M44 + M11*M23*M32*M44)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0]
 
% % solve for the initial state trajectory
% E_k1 = get_next_step(F_Ed, E, initial_state);
% 
% for time = 0.0: tau: 1.0
%     E_k = E_k1;
%     E_k1 = get_next_step(F_Ed, E, E_k);
% end

%------------- END OF CODE --------------
